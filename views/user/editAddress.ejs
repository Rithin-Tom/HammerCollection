

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.22.0/dist/sweetalert2.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<style>
  .error-message{
      color: rgb(255, 0, 0);
      font-size: 0.75rem;
      display: none;

    }
</style>
<body style="
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  background-image: url('https://i.pinimg.com/736x/fa/4a/fa/fa4afaac480367b0867308624a84fda9.jpg');
  background-size: cover;
  background-position: center;
  min-height: 100vh;
">

<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
    
     <%- include('../partials/user/sideBar', { user: user }) %>

  
    <div class="col-12 col-md-9 d-flex justify-content-center align-items-center p-4">
      <div class="bg-white rounded-4 shadow p-4" style="width: 100%; max-width: 700px; border: 40px solid #1b3954;">

        <h4 class="text-center mb-4">Add New Address</h4>

       

        <form  id="FormAddress">
          <div class="d-flex justify-content-end mb-3">
  <a href="/profile/addressBook" class="btn btn-outline-secondary">‚Üê Back to Address Book</a>
</div>

 
  <div class="mb-3">
    <label for="addressType" class="form-label">Address Type</label>
    <select class="form-select" id="addressType" >
      
      <option value="<%= userAddress.addressType %>"><%= userAddress.addressType %></option>
      <option value="Home">Home</option>
      <option value="Work">Work</option>
      <option value="Other">Other</option>
    </select>
    <div id="error1" class="error-message" ></div>
  </div>

  <div class="mb-3">
    <label for="fullName" class="form-label">Full Name</label>
    <input type="text" class="form-control" id="fullName"  value="<%= userAddress.name %>" placeholder="Enter full name">
    <div id="error2" class="error-message" ></div>
  </div>

  <div class="mb-3">
    <label for="phone" class="form-label">Phone Number</label>
    <input type="text" class="form-control" id="phone" value="<%= userAddress.phone %>"   placeholder="Enter phone number">
    <div id="error3" class="error-message" ></div>
  </div>
  <div class="mb-3">
    <label for="Phone" class="form-label">alternate Phone Number</label>
    <input type="text" class="form-control" id="altPhone" value="<%= userAddress.altPhone %>"  placeholder="Enter phone number">
    <div id="error9" class="error-message" ></div>
  </div>

  <div class="mb-3">
    <label for="address" class="form-label">Address Line</label>
    <textarea class="form-control" id="address" rows="3"  placeholder="Enter your address"><%= userAddress.addressLine %></textarea>
    <div id="error4" class="error-message" ></div>
  </div>


  <div class="mb-3">
    <label for="state" class="form-label">State</label>
    <select class="form-select" id="state" onchange="loadCities()" >
      <option value="<%= userAddress.state %>"><%= userAddress.state %></option>
      <option value="Kerala">Kerala</option>
      <option value="Tamil Nadu">Tamil Nadu</option>
      <option value="Karnataka">Karnataka</option>
    </select>
    <div id="error5" class="error-message" ></div>
  </div>

  
  <div class="mb-3">
    <label for="city" class="form-label">City</label>
    <select class="form-select" id="city" >
      <option value="<%= userAddress.city %>"><%= userAddress.city %></option>
    </select>
    <div id="error6" class="error-message" ></div>
  </div>

   <div class="mb-3">
    <label for="landMark" class="form-label">landMark</label>
    <input type="text" class="form-control" id="landMark" value="<%= userAddress.landMark%>" placeholder="landMark">
    <div id="error8" class="error-message" ></div>
  </div>

  <div class="mb-3">
    <label for="pincode" class="form-label">Pincode</label>
    <input type="text" class="form-control" id="pincode" value="<%= userAddress.pincode %>" placeholder="Pincode">
    <div id="error7" class="error-message" ></div>
  </div>

  <div class="d-grid">
    <button type="submit" class="btn btn-dark">Save Address</button>
  </div>
 
</form>


      </div>
    </div>

  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

<script>
  const citiesByState = {
    "Kerala": ["Kochi", "Trivandrum", "Calicut"],
    "Tamil Nadu": ["Chennai", "Madurai", "Coimbatore"],
    "Karnataka": ["Bangalore", "Mysore", "Mangalore"]
  };

  function loadCities() {
    const state = document.getElementById("state").value;
    const citySelect = document.getElementById("city");
    citySelect.innerHTML = '<option value="">Select city</option>';

    if (citiesByState[state]) {
      citiesByState[state].forEach(city => {
        const opt = document.createElement("option");
        opt.value = city;
        opt.textContent = city;
        citySelect.appendChild(opt);
      });
    }
  }

  document.getElementById('FormAddress').addEventListener('submit', addAddress);

  async function addAddress(event) {
    event.preventDefault(); 
    

    const addressType = document.getElementById('addressType').value.trim()
    const fullName    = document.getElementById('fullName').value.trim()
    const phone       = document.getElementById('phone').value.trim()
    const address     = document.getElementById('address').value.trim()
    const state       = document.getElementById('state').value.trim()
    const city        = document.getElementById('city').value.trim()
    const pincode        = document.getElementById('pincode').value.trim()
    const landMark = document.getElementById("landMark").value.trim()

    const altPhone = document.getElementById("altPhone").value.trim();
    

    const error1 = document.getElementById("error1");
    const error2 = document.getElementById("error2");
    const error3 = document.getElementById("error3");
    const error4 = document.getElementById("error4");
    const error5 = document.getElementById("error5");
    const error6 = document.getElementById("error6");
    const error7 = document.getElementById("error7");
    const error8 = document.getElementById("error8");
    const error9 = document.getElementById("error9");
    let    isValid =true
 
    if(addressType===""){
     error1.style.display = "block";
      error1.innerHTML = "Please select  type of your address";
      isValid =false;
    }else{
      error1.style.display = "none";
      isValid= true;
    }
    if(fullName==""){
      error2.style.display = "block";
      error2.innerHTML = "Please enter your Full Name ";
      isValid =false;
    }else{
      error2.style.display = "none";
      isValid= true;
    }
    if(phone=="" || !/^\d{10}$/.test(phone)){
      error3.style.display = "block";
      error3.innerHTML = "Please enter a vaild phone number";
      isValid= false;
    }else{
      error3.style.display = "none";
      isValid= true;
    }
     if(address==""){
      error4.style.display = "block";
      error4.innerHTML = "Please enter  your address";
      isValid= false;
    }else{
      error4.style.display = "none";
      isValid= true;
    }
     if(state==""){
      error5.style.display = "block";
      error5.innerHTML = "Please enter select  your state ";
      isValid= false;
    }else{
      error5.style.display = "none";
      isValid= true;
    }
     if(city==""){
      error6.style.display = "block";
      error6.innerHTML = "Please enter your city ";
      isValid= false;
    }else{
      error6.style.display = "none";
      isValid= true;
    }
    if (pincode === "" || !/^\d{6}$/.test(pincode)) {
    error7.style.display = "block";
    error7.innerHTML = "Please enter a valid 6-digit PIN code";
    isValid = false;
  }else{
     error7.style.display = "none";
      isValid= true;
    }

    if (landMark === "" ) {
    error8.style.display = "block";
    error8.innerHTML = "Please enter your  landMark";
    isValid = false;
  }else{
     error8.style.display = "none";
      isValid= true;
    }

    if(altPhone==="" ||!/^\d{10}$/.test(phone)){
      error9.style.display = "block";
    error9.innerHTML = "Please enter your alternate phone number";
    isValid = false;
    }else{
      error9.style.display="none"
      isValid=true
    }
   

     if (!isValid) return;
     


    try {

      const res = await fetch('/profile/editAddress/<%= index %>',{
        method:"PUT",
        headers:{ 'Content-Type': 'application/json'},
        body:JSON.stringify({
          fullName,
          altPhone,
          phone,
          addressType,
          address,
          pincode,
          state,
          landMark,
          city
        })

      })

      const result = await res.json()

      

      if(!result.success){
         Swal.fire({
        icon: "error",
        title: result.message ,
        showConfirmButton: false,
        timer: 1000
      }).then(() => {
        window.location.href ='/profile/addressBook'|| result.Url;
      });

      }else{
         Swal.fire({
        icon: "success",
        title: "address updated",
        showConfirmButton: false,
        timer: 1000
      }).then(() => {
        window.location.href ='/profile/addressBook'|| result.Url;
      });
      }
      
    } catch (error) {
      console.log(error)
    }
  }






</script>


