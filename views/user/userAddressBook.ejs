
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-image: url('https://i.pinimg.com/736x/fa/4a/fa/fa4afaac480367b0867308624a84fda9.jpg');
      background-size: cover;
      background-position: center;
      min-height: 100vh;
    }
    .main-card {
      background-color: white;
      border-radius: 25px;
      border: 40px solid rgb(27, 57, 84);
      padding: 2rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }
    .address-card {
      border: 2px solid #ccc;
      border-radius: 15px;
      padding: 1rem;
      background-color: #f8f9fa;
      position: relative;
    }
    .address-card {
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  border: 1px solid #ccc;
  padding: 1rem;
  border-radius: 8px;
  background-color: #f9f9f9;
}

  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
     <%- include('../partials/user/sideBar', { user: user }) %>
  

    <!-- Main Content -->
    <div class="col-12 col-md-9 p-4">
      <div class="main-card">

        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="mb-0">My Addresses</h4>
          <a href="/profile/addAddress" class="btn btn-success">
            <i class="bi bi-plus-circle me-1"></i> Add New Address
          </a>
        </div>

        <!-- Address Card 1 -->
    <% if (userAddress && userAddress.address && userAddress.address.length > 0) { %>
  <% userAddress.address.forEach((addr, index) => { %>
    <div class="mb-4">
      <div class="address-card">
        <h6><%= addr.name %> (<%= addr.addressType %>)</h6>
        <p class="mb-1"><%= addr.addressLine %>, <%= addr.landMark %></p>
        <p class="mb-1"><%= addr.city %>, <%= addr.state %> - <%= addr.pincode %></p>
        <p class="mb-1">Phone: +91 <%= addr.phone %></p>
        <% if (addr.altPhone) { %>
          <p class="mb-1">Alt Phone: +91 <%= addr.altPhone %></p>
        <% } %>

        <div class="position-absolute top-0 end-0 m-2">
          <a href="/profile/editAddress/<%= index %>" class="btn btn-sm btn-outline-primary me-2">
            <i class="bi bi-pencil"></i>
          </a>
            <form class="delete-address-form" data-index="<%= index %>" style="display:inline;">
              <button type="submit" class="btn btn-sm btn-outline-danger">
                <i class="bi bi-trash"></i>
              </button>
            </form>

        </div>
      </div>
    </div>
  <% }) %>
<% } else { %>
  <p>No addresses found. Click "Add New Address" to get started.</p>
<% } %>


      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
</body>
<script>
 document.addEventListener('DOMContentLoaded', () => {
    const deleteForms = document.querySelectorAll('.delete-address-form');

    deleteForms.forEach(form => {
      form.addEventListener('submit', async function (e) {
        e.preventDefault();

        const index = form.getAttribute('data-index');

        const confirm = await Swal.fire({
          title: 'Are you sure?',
          text: "You won't be able to undo this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
          confirmButtonText: 'Yes, delete it!'
        });

        if (confirm.isConfirmed) {
          try {
            const response = await fetch(`/profile/deleteAddress/${index}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              }
            });

            if (response.ok) {
              await Swal.fire('Deleted!', 'Address has been removed.', 'success');
              window.location.reload(); 
            } else {
              await Swal.fire('Error', 'Failed to delete the address.', 'error');
            }
          } catch (err) {
            console.error('Delete error:', err);
            Swal.fire('Error', 'Something went wrong.', 'error');
          }
        }
      });
    });
  });
</script>
