
  <meta charset="UTF-8">
  <title>Checkout Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <style>
    .cart-item {
  transition: all 0.4s ease;
  opacity: 1;
  transform: translateX(0);
}

.cart-  .removing {
  opacity: 0;
  transform: translateX(-50px); /* slide to left while fading out */
  height: 0;
  padding: 0;
  margin: 0;
  overflow: hidden;
}
/*  */
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
    }

    .bg-comic {
      background-image: url('https://i.pinimg.com/736x/31/8e/f9/318ef9761da0a005f2ed5d67c38deed5.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
      padding: 0px 0px;
    }

    .checkout-container {
      background-color: rgba(13, 110, 253, 0.75);
      border: 2px solid white;
      backdrop-filter: blur(6px);
    }

    .img-thumb-small {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 0.25rem;
    }

    .price-box {
      background-color: #000;
      color: #fff;
      padding: 1rem;
      border-radius: 0.75rem;
    }

    .address-card {
      background: white;
      color: black;
      padding: 1rem;
      border-radius: 0.75rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>

<div class="bg-comic">
  <section class="checkout-section py-5 px-3">
    <div class="container rounded-4 p-4 text-white shadow-lg checkout-container">
      <div class="row gy-4">

        <!-- LEFT: PRODUCT DETAILS + PAYMENT -->
        <div class="col-lg-7">

          <!-- ✅ PRODUCTS LIST SECTION -->
          <!-- Replace this <ul> loop dynamically if using EJS for cart items -->

          <ul class="list-group mb-4">
            <!-- Product 1 -->

               <% if (cart.items.length > 0) { %>
                  <% cart.items.forEach(item => { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center" id="item-<%= item.productId._id %>">
                      <div class="d-flex align-items-center">
                        <img src="<%= item.productId.productImage[0] %>" alt="Product" style="object-fit: contain;" class="img-thumb-small me-3">
                      
                        <div>
                          <h6 class="my-0 mb-1"><%= item.productId.productName %></h6>
                        </div>
                      </div>
                    
                      <div class="d-flex align-items-center">
                        <span class="text-muted me-3">items(<%= item.quantity %>)</span>
                        <span class="text-muted me-3">₹<%= item.total %></span>
                        <button class="btn btn-sm btn-outline-danger" onclick="removeItem('<%= item.productId._id %>')">Remove</button>
                      </div>
                    </li>
                  <% }) %>
                <% } %>

          


            <!-- Product 2 -->
    

            <!-- Total -->
            <li class="list-group-item d-flex justify-content-between">
              <strong id="totalItems" >Total (<%= cart.totalItems %>)</strong>
              <strong id="totalPrice">₹<%= cart.totalPrice %></strong>
            </li>
          </ul>

          <!-- ✅ PAYMENT METHODS SECTION -->
          <div class="mt-4">
            <h5 class="fw-bold">Payment Methods</h5>
            <p>Select a payment method</p>
            <div class="form-check mb-2">
              <input class="form-check-input" type="radio" name="payment" id="card" checked>
              <label class="form-check-label" for="card">Card</label>
              <img src="https://img.icons8.com/color/32/visa.png" class="ms-2" />
              <img src="https://img.icons8.com/color/32/mastercard.png" />
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="radio" name="payment" id="bank">
              <label class="form-check-label" for="bank">Online Banking</label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="radio" name="payment" id="wallet">
              <label class="form-check-label" for="wallet">Wallet / UPI</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="payment" id="cod">
              <label class="form-check-label" for="cod">Cash on Delivery</label>
            </div>
          </div>
        </div>

        <!-- RIGHT: ADDRESS + ORDER SUMMARY -->
        <div class="col-lg-5">
          <!-- ✅ ADDRESS SECTION -->
         <h5 class="fw-bold mb-3">Select Delivery Address</h5>

<!-- Address Dropdown -->
<div class="mb-3">
  <select class="form-select" id="addressSelect" onchange="displaySelectedAddress()">
    <option value="0">John Doe - 123 Street, Kochi</option>
    <option value="1">Jane Smith - 456 Avenue, Trivandrum</option>
  </select>
</div>

<!-- Address Display Box -->
<div id="addressDisplay" class="address-card">
  <p class="fw-bold mb-1" id="name">John Doe<br>123 Street, Kochi, Kerala<br>Pin: 682001</p>
  <p class="mb-1" id="contact">Contact: +91 98765 43210</p>
</div>


          <!-- Add new address -->
          <a href="/profile/addAddress" class="btn btn-outline-light w-100 mb-4">+ Add New Address</a>

          <!-- ✅ CART TOTAL SECTION -->
          <div class="price-box">
            <p class="d-flex justify-content-between mb-1"><span>Subtotal:</span><span>₹1697.00</span></p>
            <p class="d-flex justify-content-between mb-1"><span>Shipping:</span><span>Free</span></p>
            <hr class="border-light">
            <p class="d-flex justify-content-between fw-bold"><span>Total:</span><span>₹1697.00</span></p>

            <!-- Coupon -->
            <div class="d-flex mt-3">
              <input type="text" class="form-control me-2" placeholder="Coupon Code">
              <button class="btn btn-outline-light">Apply</button>
            </div>

            <!-- Place Order -->
            <button class="btn btn-light text-dark mt-3 w-100">Place Order</button>
          </div>
        </div>

      </div>
    </div>
  </section>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
   const addresses = [
    {
      name: "John Doe",
      address: "123 Street, Kochi, Kerala",
      pin: "682001",
      contact: "+91 98765 43210"
    },
    {
      name: "Jane Smith",
      address: "456 Avenue, Trivandrum",
      pin: "695001",
      contact: "+91 90000 12345"
    }
  ];

  function displaySelectedAddress() {
    const index = document.getElementById("addressSelect").value;
    const selected = addresses[index];
    document.getElementById("name").innerHTML = `${selected.name}<br>${selected.address}<br>Pin: ${selected.pin}`;
    document.getElementById("contact").textContent = `Contact: ${selected.contact}`;
  }


  async function removeItem(productId) {

    const res = await fetch('/cart/delete',{
      method:"DELETE",
      headers:{'content-type':'application/json'},
      body:JSON.stringify({
        productId

      })
    })

    const result = await res.json();

    if(result.success){

      let itemDiv = document.getElementById(`item-${productId}`);

      if (itemDiv) {
      itemDiv.classList.add('removing');
      setTimeout(() => itemDiv.remove(), 400); // match with CSS duration
    }
      
     

      Swal.fire({
        toast: true,
        position: 'top-end',
        icon: 'success',
        title: 'removed from the  cart!',
        showConfirmButton: false,
        timer: 1500,
        timerProgressBar: true
      });
      document.getElementById('totalItems').innerText = result.cart.totalItems;
      document.getElementById('totalPrice').innerText = result.cart.totalPrice;
      
    } else {
      Swal.fire({
       toast: true,
       position: 'top-end',
       icon: 'error',
       title: data.message ||'Failed to remove from the  cart:',
       showConfirmButton: false,
       timer: 1500,
       timerProgressBar: true
      });

    }
    
  }


</script>

</body>

